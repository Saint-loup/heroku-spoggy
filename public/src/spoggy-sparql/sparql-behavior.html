
<script>
var SparqlBehaviorMixin = Polymer.dedupingMixin(function(superClass){
  return class SparqlBehavior extends superClass {
    constructor() {
      super();
      //  console.log("Mode behavior")
      //  console.log(this.inputProp);
    }

    static get properties() {
      return {
        inputProp: {
          type: String,
          value: 'modeB'
        },
        urls: {
          type : Array,
          value: []
        }
      };
    }

    testFuseki(mess){
      console.log(mess);
      this.url_fuseki = mess.endpoint;
      this.url_fuseki_ping = mess.endpoint+"/$/ping";
      //  this.$.status_req.body = { "email": "abc@gmail.com", "password": "password" };
      console.log(this.url_fuseki_ping);
      this.$.fusekiPing.generateRequest();
    }
    testVirtuoso(mess){
      console.log(mess);
      let endpoint = mess.endpoint;
        this.agentSparql.send('agentVirtuoso', {type:'describe', url: endpoint+'/sparql', resource : mess.resource});
    //  this.agentSparql.send('agentVirtuoso', {type:'updateUrl', url: endpoint+'/sparql', resource : mess.resource});
      /* PAs trouvé moyen de faire un Ping ??this.url_virtuoso_ping = endpoint+"/sparql";
      //  this.$.status_req.body = { "email": "abc@gmail.com", "password": "password" };
      console.log(this.url_virtuoso_ping);
      this.$.virtuosoPing.generateRequest();*/
    }


    _updateUrl(){
      console.log(this.url_fuseki);
      console.log(this.dataset);
      let url = this.url_fuseki+this.dataset;
      /*  this.set('urls.endpoint', url);
      this.set('urls.upload', url+'/upload');//File Upload: http://5.51.110.50:3030/spoggy/upload
      this.set('urls.data', url+'/data');//Graph Store Protocol: http://5.51.110.50:3030/spoggy/data
      this.set('urls.read', url+'/get');//Graph Store Protocol (Read): http://5.51.110.50:3030/spoggy/get
      this.set('urls.quads', url+'/');//HTTP Quads: http://5.51.110.50:3030/spoggy/
      this.set('urls.query', url+'/query');//SPARQL Query: http://5.51.110.50:3030/spoggy/query
      this.set('urls.sparql', url+'/sparql');//SPARQL Query: ttp://5.51.110.50:3030/spoggy/sparql
      this.set('urls.update', url+'/update');//SPARQL Update: http://5.51.110.50:3030/spoggy/update
      console.log(this.urls)
      */
      this.agentSparql.send('agentStatements', {type:'updateUrl', url: url+'/query'});
      this.agentSparql.send('agentSparqlUpdate', {type: 'updateUrl', url: url+'/update'});

    }

    //PING
    _handleFusekiPing(data){
      console.log("ping  Fuseki ok");

      this.pingFuseki = data;
      console.log(data);
      this.status = data.detail.response;
      console.log(this.status);
      this.url_server = this.url_fuseki+"/$/server";
      //  this.$.status_req.body = { "email": "abc@gmail.com", "password": "password" };
      console.log(this.url_server);
      this.$.server_req.generateRequest();
      this.$.fusekiPopup.toggle();
      this.$.labelEndpoint.label = "Endpoint : ping Fuseki OK";
    }
    _handleFusekiPingError(data){
      console.log("error ping  Fuseki");
      this.$.labelEndpoint.label = "Endpoint : ping Erreur"
      this.pingFuseki = "";
      console.log(data);
      console.log(data.detail);
      console.log(data.detail.error);
      console.log(data.detail.error.message);
      console.log(data.detail.request);
      console.log(data.detail.response);
      console.log(data.detail.request.response);
      this.status = data.detail.error.type + ", Veuillez vérifier l'accès au endpoint "+this.url_status;
      console.log(this.status);
      this.server = data.detail.error.type + ", Veuillez vérifier l'accès au endpoint "+this.url_status;
    }


    //PING
    _handleVirtuosoPing(data){
      console.log("ping Virtuoso ok");
      this.$.labelEndpoint.label = "Endpoint : ping OK";
      this.pingVirtuoso = data;
      console.log(data);
      this.status = data.detail.response;
      console.log(this.status);
      //  this.url_server = this.endpoint+"/$/server";
      //  this.$.status_req.body = { "email": "abc@gmail.com", "password": "password" };
      //  console.log(this.url_server);
      //  this.$.server_req.generateRequest();
    }
    _handleVirtuosoPingError(data){
      console.log("error ping Virtuoso");
      this.$.labelEndpoint.label = "Endpoint : ping Virtuoso Erreur"
      this.pingVirtuoso = "";
      console.log(data);
      console.log(data.detail);
      console.log(data.detail.error);
      console.log(data.detail.error.message);
      console.log(data.detail.request);
      console.log(data.detail.response);
      console.log(data.detail.request.response);
      this.status = data.detail.error.type + ", Veuillez vérifier l'accès au endpoint "+this.url_status;
      console.log(this.status);
      this.server = data.detail.error.type + ", Veuillez vérifier l'accès au endpoint "+this.url_status;
    }


    _datasetChanged(e){
      this.dataset = e.model.item.ds_name;
    }













    //SERVER
    _handleFusekiServer(data){
      console.log("server ok");
      console.log(data);
      var clemodif = data.detail.response.replace(/ds\./g, "ds_")
      this.server = JSON.parse(clemodif);
      console.log(this.server);
      this.datasets = this.server.datasets;
      this.dataset = this.datasets[0].ds_name;
      console.log(this.datasets);
    }
    _handleFusekiServerError(data){
      console.log("error server");
      console.log(data);
      console.log(data.detail);
      console.log(data.detail.error);
      console.log(data.detail.error.message);
      console.log(data.detail.request);
      console.log(data.detail.response);
      console.log(data.detail.request.response);
      this.server = data.detail.error.type + ", Veuillez vérifier l'accès au endpoint "+this.url_status;
      console.log(this.server);
    }




  }
});

</script>

<!--
# SPOGGY INPUT
- Saisir un message pour le chat
Un message pour le chat ne doit ni commencer par / , ; .
nii se terminer par , ; . sinon, il sera considéré comme un triplet

- Saisir un triplet au format Turtle
Une saisie qui ne se termine pas par . ou ; ou , n'est pas pris en compte comme un triplet
David a man. -> triplet complet,
David a man; -> indique de garder le sujet
David a man, -> indique de garder sujet et propriete


- Récupérer le dernier triplet saisi
en commençant par . -> on récupère tout le dernier triplet
en commençant par ; -> on récupère le sujet et la propriete
en commençant par , -> on récupère seulement le dernier sujet

- Saisir une commande
le commandes commencent par / -> exemple /h pour afficher l'aide
-->


<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../../bower_components/lazy-imports/lazy-imports-mixin.html">


<!--
<link rel="import" href="../spoggy-tools/spoggy-tools.html">-->
<link rel="import" href="./input-behavior.html">


<!--
Suppression pour passage par les agents
<link rel="import" href="../spoggy-data/data-behavior.html">
<link rel="import" href="../spoggy-mode/spoggy-mode.html">-->




<link rel="import" href="./input-styles.html">
<dom-module id="spoggy-input">


  <link rel="lazy-import" group="lazy" href="../../bower_components/paper-input/paper-input.html">

  <link rel="lazy-import" group="lazy" href="../../bower_components/chat-window/chat-window.html">
    <link rel="lazy-import" group="lazy" href="./input-dialogs.html">

  <link rel="lazy-import" group="lazy" href="../../bower_components/iron-collapse-button/iron-collapse-button.html">
  <template>
    <style is="custom-style" include="input-styles">
    .inputbtn{
      @apply --layout-horizontal;
      @apply --layout-flex;
    }
    #fabAide {
      position: fixed;
      right: 5px;
      top: 10px;
    }

    </style>

    <style is="custom-style">
    chat-window.styled {
      font-size: small;
      /*position: absolute;
      top: 100px;*/

      --chat-messages-height: 12em;
      --paper-input-container-input: {
        margin: 0 2px;
      /*  z-index:100;*/
      }
      --chat-message-text: {
        z-index:100;
        background-color: #f0f0f0;
        padding: 6px 8px;
        margin: 4px 0;
        border-radius: 6px;
      };

      }
    }
  }
  </style>


<input-dialogs id="dialogs"></input-dialogs>


  <!--  <spoggy-tools id='tools' lazyRegister sources="{{sources}}" network={{network}}></spoggy-tools> -->



                <paper-input id="inputMessage"
                class="inputMessage"
                on-change="traiteMessage"
                label="3 mots une virgule et Entrée"
                raised
                autofocus>
              </paper-input>


        <!--    <chat-window
            id = "chat"
            class="styled"
            author="me"
            single-line
            input-text="{{text}}"
            messages="[[messages]]"
            on-send="sendMsg"
            ></chat-window>-->

<!--
          <chat-input
          author="me"
          class="styled"
          single-line
          single-line="[[singleLine]]"
          icon="[[sendIcon]]"
          text="{{inputText}}"
          on-send="sendMsg"></chat-input>

          <chat-messages
          class="styled"
          id = "chat"
          author="[[author]]"
          author-icon="[[authorIcon]]"
          others-icons="[[othersIcons]]"
          default-icon="[[defaultIcon]]"
          messages="[[messages]]"
          date-format="[[dateFormat]]"
          auto-scroll="[[autoScroll]]">
        </chat-messages>
-->





        <!--<div style="align:right">
        <paper-icon-button icon="help" on-tap="afficheAide"></paper-icon-button>
      </div>-->
      <paper-fab id="fabAide" on-tap="afficheAide"  icon="help" style="height: 50px; width:50px;"></paper-fab>


    </template>

    <script>
    /**
    * `spoggy-input`
    *
    *
    * @customElement
    * @polymer
    * @demo demo/index.html
    */
    class SpoggyInput extends InputBehaviorMixin(Polymer.LazyImportsMixin(Polymer.Element)) {
      static get is() { return 'spoggy-input'; }
      static get properties() {
        return {
          prop1: {
            type: String,
            value: 'spoggy-input'
          },
          commandHistory:{
            type : Array,
            value: []
          },
          sources:{
            type: Array,
            notify: true
          },
          messages : {
            type : Array,
            value : [
              { author: 'you', text: 'dummy msg 1', created: this.now - (60*1000) },
              { author: 'me', text: 'dummy msg 2', created: this.now - (3*60*1000) },
              { author: 'you', text: 'dummy msg 3', created: this.now - (10*60*1000) },
              { author: 'you', text: 'dummy msg 4', created: this.now - (60*60*1000) },
              { author: 'me', text: 'dummy msg 5', created: this.now - (1.2*60*60*1000) },
              { author: 'me', text: 'dummy msg 6', created: this.now - (1.5*60*60*1000) },
              { author: 'you', text: 'dummy msg 7', created: this.now - (11.5*60*60*1000) },
              { author: 'me', text: 'dummy msg 8', created: this.now - (12*60*60*1000) },
              { author: 'you', text: 'dummy msg 9', created: this.now - (13*60*60*1000) },
              { author: 'me', text: 'dummy msg 10', created: this.now - (1.5*24*60*60*1000) },
              { author: 'you', text: 'dummy msg 11', created: this.now - (1.6*24*60*60*1000) },
              { author: 'me', text: 'dummy msg 12', created: this.now - (4*24*60*60*1000) },
              { author: 'me', text: 'dummy msg 13', created: this.now - (4.5*24*60*60*1000) },
              { author: 'you', text: 'dummy msg 14', created: this.now - (14*24*60*60*1000) },
              { author: 'me', text: 'dummy msg 15', created: this.now - (14.5*24*60*60*1000) },
            ]
          }
        };
      }

      constructor(){
        super();
        this.agentInput = new InputAgent('agentInput', this);
        Polymer.RenderStatus.afterNextRender(this, function() {
          // When possible, use afterNextRender to defer non-critical
          // work until after first paint.
          this._deferred();

        });
      }
      _deferred(){
        this.importLazyGroup('lazy').then((results) => {
          console.log(results);
          this.dispatchEvent(new CustomEvent('import-loaded', results));
        });
          this.initAgents()
      }
      initAgents(){
        console.log(this.agentInput)
        this.agentInput.send('agentHello', 'Hello agentHello!');
      }
      connectedCallback(){
        //  console.log("agent DATA connected");
      }

      sendMsg(e){
        // filtrer avant de passer en mode chat
        console.log(e.detail)
        //  this.agentInput.send('agentHello', 'Hello FROM CHAT '+e.detail);
        var mess = {}
        mess.type = "chat";
        mess.data = e.detail;
        this.agentInput.send('agentData', mess);

        this.$.chat.messages = this.messages;
        this.author = this.author == 'me' ? 'you' : 'me'; // For demo
        this.$.chat.push('messages',{
          author: this.author,
          text: e.detail,
          created: Date.now()
        });

      }

      updateInputValue(texte){

        //merdique obligé de mettre ce behavior sur spoggy-graph pour cette fonction !
        console.log("Element");
        console.log(texte);

        this.$.inputMessage.value = texte;
      }

    }

    window.customElements.define(SpoggyInput.is, SpoggyInput);
    </script>
  </dom-module>
